# Как собрать свой радар для самолетов

## Оборудование
- SDR USB (подходит любой)
- Raspberry Pi 2-3-4 (подойдет любая "большая", все, кроме первых B и Zero)
- Сборка антенны:
	- https://discussions.flightaware.com/t/three-easy-diy-antennas-for-beginners/16348 - примеры простых антенн
	- http://forum.pilotaware.com/index.php?topic=1600.0 - всякие навороченные, но не получилось
	- https://discussions.flightaware.com/t/has-anyone-tried-a-collinear-antenna-like-this/18634/13 - еще с наворотами

У меня лучше всего заработала can-tena из первого примера

Рекомендации по размещению антенны: https://www.flightradar24.com/files/positioning_mode-s_antenna.pdf

Общее правило с антеннами (заодно, порядок приоритета "что еще попробовать"):
- правильно подобранный резонанс антенны (длины проводников, размеры банки и т.п.)
- чем больше антенна - тем лучше, но резонанс важнее
- чем короче провода до SDR - тем лучше, идеально должны быть "один в один"
- усилитель ставить нужно с bandpass фильтром, а то будет неприятно

## Программное обеспечение

1. Самое правильное - просто установить и настроить готовый образ от FlightRadar24 или ему подобных. Почему это хорошо:
- все заработает "из коробки"
- у них наглядная интересная статистика, которой удобно пользоваться
- высокий индекс доверия
- предоставят business-доступ к системе, что дает возможность смотреть на самолетики с большим комортом

Самая простая и правильная инструкция для "сделай сам": https://www.flightradar24.com/build-your-own

Начать можно с той антенной, что идет в комплекте с SDR, будет мало, но зато будет понятно, что все заработало до того, как начнется сборка антенн и т.п. 


2. FlightRadar24 устанавливает только нужное ему, но никак не то, что нужно для использования этой же радарной точки в интересах других сервисов. Есть несколько других и очень полезных, чтобы они заработали, начать надо вот с этого (и в таком порядке, потому что для ADS-B Exchange нужен ReadSB):

- установить сервис для получения бинарных данных: https://github.com/wiedehopf/adsb-scripts/wiki/Automatic-installation-for-readsb в процессе установки будет настроено усиление в автоматическом режиме, но можно там же посмотреть команды для ручного управления уровнем.

- https://github.com/adsbxchange/adsb-exchange - непосредственно сервис от ADS-B Exchange, вместе с которым нужно установить и web-интерфейс adsbx. Важно указать свои точные координаты, при настройке будет показать URL карты с высотами точки "земли", к которой важно добавить высоту антенны над землей

- и после по их же рекомендации установить wtb-интерфейс: sudo bash /usr/local/share/adsbexchange/git/install-or-update-interface.sh (команда может поменяться, они ее покажут в консоли в процессе установки)

В результате проверить, что передает радар можно вот тут: https://adsbexchange.com/myip/ но только если используется тот же IP адрес (скорее всего это так). А так же получить публичную статистику работы радара, например, как моя: https://www.adsbexchange.com/api/feeders/?feed=6600f487-33c1-4430-beba-b8e402489393 и карту: https://globe.adsbexchange.com/?feed=lWfZc9AA3uY1


## Хакинг

Во-первых, FlightRadar24 данные о самолетах в поле работы радара передает открытым текстом по вот этому адресу: http://<IP of Radar>:8754/flights.json?time=<timestamp> где timestamp передается просто для того, чтобы обойти вопрос кеширования. В моем случае вот такой код возвращал JSON с самолетами:
```
curl 'http://192.168.0.40:8754/flights.json?time=1627592900630' 
    -X 'GET' 
    -H 'Accept: application/json, text/javascript, */*; q=01' 
    -H 'Accept-Language: en-gb' 
    -H 'Host: 192.168.0.40:8754' 
    -H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.1.2 Safari/605.1.15' 
    -H 'Referer: http://192.168.0.40:8754/tracked.html' 
    -H 'Accept-Encoding: gzip, deflate' 
    -H 'Connection: keep-alive' 
    -H 'X-Requested-With: XMLHttpRequest'
```
не уверен, что все эти заголовки важны для работы, но использовал те же, что передает мой браузер на странице проверки радара: http://192.168.0.40:8754/tracked.html

Эти данные можно обрабатывать отдельно, например, как я - перекладывать их в базу данных для дальнейшего анализа и использования. К сожалению, данные скудные, но их можно обогощать данными из бругих источников.


### Данные

1. Прекрасный датасет и его обновления предлагает OpenSky, особенно стоит обратить внимание на базу дополнений: https://opensky-network.org/data/datasets#d5

2. Вручную (или немного их похачив, автоматом) можно получить данные из PlaneSpotters: https://www.planespotters.net/search?q=4C0E23, однако, API они предоставляют только тем, кто будет использовать данные для какого-то сервиса, и если только эти данные - ключевые для этого сервиса. Есть ограничение на количество запросов в период времени, а в коде ждет сообщение для любопытствующих как получить доступ к API (никак).

3. AirPortData предлагает неполную, зато бесплатную базу о самолетах, снабжая каждый небольшой картинкой-превью со ссылкой на большую и качественную на их сервисе, вот тут есть описание сервиса: https://www.airport-data.com/api/doc.php

4. Платная база с данными о самолетах: https://rapidapi.com/adsbx/api/adsbexchange-com1/pricing, несмотря на участие в сборе данных, кажется, получить от них данные о самолетах бесплатно не получится, если не разбирать их API в обратную сторону от старниц с локальной картой и данными

## Дополнительное чтение:

* https://ianrenton.com/hardware/planesailing/
* https://www.sarcnet.org/ais-receiver.html
* https://rapidapi.com/adsbx/api/adsbexchange-com1/pricing
